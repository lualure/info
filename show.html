<!DOCTYPE html>

<html>
<head>
  <title>/Users/timm/src/src/show.lua</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="locco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
              /Users/timm/src/src/show.lua
            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
<tr id="section-1">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-1">&#182;</a>
  </div>
  


</td>
<td class="code">
  <div class="highlight"><pre>
</pre></div>
</td>
</tr><tr id="section-2">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-2">&#182;</a>
  </div>
  
<p>[[</p>


</td>
<td class="code">
  <div class="highlight"><pre>Matias Guijarro wrote:
&gt; I would like to change the default behaviour of Lua when
&gt; representing a table through the <span class="nt">tostring</span>() <span class="k">function</span> ; I
&gt; would prefer to have something more like <span class="k">in</span> Python <span class="k">for</span>
&gt; example (instead of having <span class="s">"table: 0x8062ac0"</span>, I would
&gt; like to see the contents, <span class="k">for</span> example { 1, 2, 3 }).
&gt;
&gt; So first of all I tried to set a new metatable <span class="k">for</span> tables,
As Shmuel pointed out, table metatables are per-table, so
they <span class="s">'t really work for what you want to do.
  Lua 5.1.1  Copyright (C) 1994-2006 Lua.org, PUC-Rio
  &gt; Tbl = setmetatable({}, {__tostring = function(t)
  &gt;&gt;                                        return "Hello!"
  &gt;&gt;                                      end})
  &gt; print(Tbl) -- Works for this table,
  Hello!
  &gt; print({}) -- but doesn'</span>t work <span class="k">for</span> other tables.
  table: 0x493378
A way that will work is to simply replace the <span class="nt">tostring</span>
<span class="k">function</span> <span class="nf">itself.</span>  Replace it with a <span class="k">function</span> <span class="nf">that</span> calls your
table-to-string <span class="k">function</span> <span class="nf"><span class="k">for</span></span> tables, <span class="o">and</span> calls the original
<span class="nt">tostring</span> <span class="k">for</span> everything <span class="k">else</span>.
<span class="s">'s Programming in Lua book explains how to write the
table-to-string function.  (The first edition is available
online: &lt;http://www.lua.org/pil/12.1.html&gt;.)
As it happens, I happened to write an implementation of just
the functionality you'</span>re looking <span class="k">for</span> a few days ago.  It is
below, but I encourage you to try whipping together at least
a simple version of your own before looking at mine.
- Aaron
]]
</pre></div>
</td>
</tr><tr id="section-3">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-3">&#182;</a>
  </div>
  
<p>This script makes tostring convert tables to a
representation of their contents.</p>


</td>
<td class="code">
  <div class="highlight"><pre>
</pre></div>
</td>
</tr><tr id="section-4">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-4">&#182;</a>
  </div>
  
<p>The real tostring:</p>


</td>
<td class="code">
  <div class="highlight"><pre><span class="k">local</span> _<span class="nt">tostring</span> = <span class="nt">tostring</span>
</pre></div>
</td>
</tr><tr id="section-5">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-5">&#182;</a>
  </div>
  
<p>Characters that have non-numeric backslash-escaped versions:</p>


</td>
<td class="code">
  <div class="highlight"><pre><span class="k">local</span> BsChars = {
  [<span class="s">"\a"</span>] = <span class="s">"\\a"</span>,
  [<span class="s">"\b"</span>] = <span class="s">"\\b"</span>,
  [<span class="s">"\f"</span>] = <span class="s">"\\f"</span>,
  [<span class="s">"\n"</span>] = <span class="s">"\\n"</span>,
  [<span class="s">"\r"</span>] = <span class="s">"\\r"</span>,
  [<span class="s">"\t"</span>] = <span class="s">"\\t"</span>,
  [<span class="s">"\v"</span>] = <span class="s">"\\v"</span>,
  [<span class="s">"\""</span>] = <span class="s">"\\\""</span>,
  [<span class="s">"\\"</span>] = <span class="s">"\\\\"</span>}
</pre></div>
</td>
</tr><tr id="section-6">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-6">&#182;</a>
  </div>
  
<p>Is Str an "escapeable" character (a non-printing character other than
space, a backslash, or a double quote)?</p>


</td>
<td class="code">
  <div class="highlight"><pre><span class="k">local</span> <span class="k">function</span> <span class="nf">IsEscapeable</span>(Char)
  <span class="k">return</span> string.find(Char, <span class="s">"[^&#37;w&#37;p]"</span>) <span class="c">-- Non-alphanumeric, non-punct.
</span>    <span class="o">and</span> Char ~= <span class="s">" "</span> <span class="c">-- Don't count spaces.
</span>    <span class="o">or</span> string.find(Char, <span class="s">'[\\"]'</span>) <span class="c">-- A backslash or quote.
</span><span class="k">end</span>
</pre></div>
</td>
</tr><tr id="section-7">
<td class="docs">
  <div class="pilwrap">
    <a class="pilcrow" href="#section-7">&#182;</a>
  </div>
  
<p>Converts an "escapeable" character (a non-printing character,
backslash, or double quote) to its backslash-escaped version; the
second argument is used so that numeric character codes can have one
or two digits unless three are necessary, which means that the
returned value may represent both the character in question and the
digit after it:</p>


</td>
<td class="code">
  <div class="highlight"><pre><span class="k">local</span> <span class="k">function</span> <span class="nf">EscapeableToEscaped</span>(Char, FollowingDigit)
  <span class="k">if</span> IsEscapeable(Char) <span class="k">then</span>
    <span class="k">local</span> Format = FollowingDigit == <span class="s">""</span>
      <span class="o">and</span> <span class="s">"\\&#37;d"</span>
      <span class="o">or</span> <span class="s">"\\&#37;03d"</span> .. FollowingDigit
    <span class="k">return</span> BsChars[Char]
      <span class="o">or</span> string.format(Format, string.byte(Char))
  <span class="k">else</span>
    <span class="k">return</span> Char .. FollowingDigit
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td>
</tr>